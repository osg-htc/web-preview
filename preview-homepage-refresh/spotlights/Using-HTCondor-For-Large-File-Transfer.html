<!doctype html>
<html lang="en-US">
<head>
    
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<link rel="icon" href="/favicon.ico">



<!-- Bootstrap 5 -->
<link rel="stylesheet" href="/web-preview/preview-homepage-refresh/assets/css/style.css?v=">
<!--[if lt IE 9]>
<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
<script src="/web-preview/preview-homepage-refresh/assets/js/bootstrap.bundle.min.js" ></script>




<script src="/web-preview/preview-homepage-refresh/assets/js/base.js" defer></script>


</head>
<body>
<header>
    <nav class="navbar navbar-light navbar-expand-md ">
        <div class="container-xxl">
            <a class="navbar-brand pt-1 pb-1" href="/web-preview/preview-homepage-refresh/">
                
                    <img style="height: 3rem" src="/web-preview/preview-homepage-refresh/assets/images/logos/OSG-logo.svg" alt="OSG logo">
                
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item dropdown active">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            About
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                            
                            
                            
                            
                            <a class="dropdown-item" href="/web-preview/preview-homepage-refresh/about/introduction/">Introduction</a>
                            
                            
                            
                            <a class="dropdown-item" href="/web-preview/preview-homepage-refresh/about/open_science_pool/">Open Science Pool</a>
                            
                            
                            
                            <a class="dropdown-item" href="/web-preview/preview-homepage-refresh/about/osdf/">Open Science Data Federation</a>
                            
                            
                            
                            <a class="dropdown-item" href="/web-preview/preview-homepage-refresh/about/organization/">Consortium Members</a>
                            
                            
                            
                            <a class="dropdown-item" href="/web-preview/preview-homepage-refresh/about/team/">The OSG Team</a>
                            
                            
                            
                            <a class="dropdown-item" href="/web-preview/preview-homepage-refresh/about/publications/">Publications</a>
                            
                            
                            <a class="dropdown-item" href="/web-preview/preview-homepage-refresh/acknowledging.html">Acknowledging OSG</a>
                        </div>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="/web-preview/preview-homepage-refresh/campus-cyberinfrastructure.html">Campuses</a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="/web-preview/preview-homepage-refresh/spotlight.html">Spotlight</a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="/web-preview/preview-homepage-refresh/news.html">News</a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="/web-preview/preview-homepage-refresh/events.html">Events</a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="/web-preview/preview-homepage-refresh/contact.html">Contact</a>
                    </li>
                    <li class="nav-item dropdown active">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown2" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Docs
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdown2">
                            <a class="dropdown-item" href="https://support.opensciencegrid.org/support/home">For Users</a>
                            <a class="dropdown-item" href="https://opensciencegrid.org/docs/">For Sysadmins</a>
                            <a class="dropdown-item" href="https://opensciencegrid.org/security/">Security</a>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container-xxl">
        <hr class="my-0"/>
    </div>
</header>
<main>
    <div class="container-xxl py-4">
    <h1 class="fs-1">How to Transfer 460 Terabytes? A File Transfer Case Study</h1>
</div>
<div class="pb-6">
    <div class="container-xxl">
    <div class="row justify-content-center">
  <div class="col-12 col-md-10 col-lg-9 col-xl-8">
    <section class="news-article">
      
      <div class="mb-1">
        <h1>How to Transfer 460 Terabytes? A File Transfer Case Study</h1>
        
        
      </div> <!-- title-head -->
      

      <div class="fs-5">
        <p>When Greg Daues at the <a href="https://resources.istcoalition.org/national-center-for-supercomputing-applications" target="_blank">National Center for Supercomputing Applications (NCSA)</a> needed to transfer 460 Terabytes of NCSA files from <a href="https://in2p3.cnrs.fr/en/node/11" target="_blank">the National Institute of Nuclear and Particle Physics (IN2P3)</a> in Lyon, France to Urbana, Illinois, for a project they were working with <a href="https://www.fnal.gov/" target="_blank">FNAL</a>, <a href="https://cc.in2p3.fr/en/" target="_blank">CC-IN2P3</a> and the <a href="https://www.lsst.org/" target="_blank">Rubin Data Production team</a>, he turned to the <a href="https://research.cs.wisc.edu/htcondor/" target="_blank">HTCondor High Throughput system</a>, not to run computationally intensive jobs, as many do, but to manage the hundreds of thousands of I/O bound transfers.</p>

<h2>The Data</h2>

<p>IN2P3 made the data available via https, but the number of files and their total size made the management of the transfer an engineering challenge.  There were two kinds of files to be transferred, with 3.5 million files with a median size of roughly 100 Mb, and another 3.5 million smaller files, with a median size of about 10 megabytes.  Total transfer size is roughly 460 Terabytes.</p>

<h2>The Requirements</h2>

<p>The requirement for this transfer was to reliably transfer all the files in a reasonably performant way, minimizing the human time to set up, run, and manage the transfer.  Note the noni-goal of optimizing for the fastest possible transfer time – reliability and minimizing the human effort take priority here.  Reliability, in this context implies:</p>

<p>Failed transfers are identified and re-run (with millions of files, a failed transfer is almost inevitable)
Every file will get transferred
The operation will not overload the sender, the receiver, or any network in between</p>

<h2>The Inspiration</h2>

<p>Daues presented unrelated work at the <a href="https://research.cs.wisc.edu/htcondor/HTCondorWeek2017/" target="_blank">2017 HTCondor Week workshop</a>.  At this workshop, he heard about the work of Phillip Papodopolous at UCSD, and his international Data Placement Lab (iDPL).   iDPL used HTCondor jobs solely for transferring data between international sites.  Daues re-used and adapted some of these ideas for NCSA’s needs.</p>

<h2>The Solution</h2>
<p>First, Daues installed a <a href="https://hub.docker.com/r/htcondor/mini" target="_blank">“mini-condor”</a>, an HTCondor pool entirely on one machine, with an access point and eight execution slots on that same machine.  Then, given a single large file containing the names of all the files to transfer, he ran the Unix split command to create separate files with either 50 of the larger files, or 200 of the smaller files.  Finally, using the HTCondor submit file command</p>

<p>Queue filename matching files *.txt</p>

<p>the condor_submit command creates one job per split file, which runs the wget2 command and passes the list of filenames to wget2.  The HTCondor access point can handle tens of thousands of idle jobs, and will schedule these jobs on the eight execution slots.  While more slots would yield more overlapped i/o, eight slots were chosen to throttle the total network bandwidth used.  Over the course of days, this machine with eight slots maintained roughly 600 MB/seconds.</p>

<p><em>(Note that the machine running HTCondor did not crash during this run, but if it had, all the jobs, after submission, were stored reliably on the local disk, and at such time as the crashed machine restarted, and the init program restarted the HTCondor system, all interrupted jobs would be restarted, and the process would continue without human intervention.)</em></p>

      </div>
    </section>
  </div>
</div>



</div>
</div>

</main>

<footer id="footer" class="mt-auto">
    <div class="shadow bg-secondary">
        <div class="container-xxl">
            <div class="row justify-content-center py-5">
                <div class="col-auto me-4 d-none d-md-flex">
                    <a class="my-auto" href="/web-preview/preview-homepage-refresh/"><img style="height:5rem" src="/web-preview/preview-homepage-refresh/assets/images/logos/OSG-logo.svg" alt="OSG logo"></a>
                </div>
                <div class="col-12 col-md-8 col-lg-8">
                    <div class="row justify-content-between my-2">
                        
                            <div class="col-6 col-lg-4 col-xl-3 my-2">
                                <table>
                                    <tr><th>About</th></tr>
                                    
                                        <tr><td><a href="/web-preview/preview-homepage-refresh/about/introduction">Introduction</a></td></tr>
                                    
                                        <tr><td><a href="/web-preview/preview-homepage-refresh/about/organization">Consortium Members</a></td></tr>
                                    
                                        <tr><td><a href="/web-preview/preview-homepage-refresh/about/team">OSG Team</a></td></tr>
                                    
                                        <tr><td><a href="/web-preview/preview-homepage-refresh/about/publications">Publications</a></td></tr>
                                    
                                </table>
                            </div>
                        
                            <div class="col-6 col-lg-4 col-xl-3 my-2">
                                <table>
                                    <tr><th>Services</th></tr>
                                    
                                        <tr><td><a href="/web-preview/preview-homepage-refresh/about/open_science_pool">Open Science Pool</a></td></tr>
                                    
                                        <tr><td><a href="/web-preview/preview-homepage-refresh/about/osdf">Open Science Data Federation</a></td></tr>
                                    
                                        <tr><td><a href="/web-preview/preview-homepage-refresh/spotlight.html">User Spotlights</a></td></tr>
                                    
                                </table>
                            </div>
                        
                            <div class="col-6 col-lg-4 col-xl-3 my-2">
                                <table>
                                    <tr><th>Documentation</th></tr>
                                    
                                        <tr><td><a href="https://support.opensciencegrid.org/support/home">User</a></td></tr>
                                    
                                        <tr><td><a href="https://opensciencegrid.org/docs/">System Admin</a></td></tr>
                                    
                                        <tr><td><a href="https://opensciencegrid.org/security/">Security</a></td></tr>
                                    
                                </table>
                            </div>
                        
                            <div class="col-6 col-lg-4 col-xl-3 my-2">
                                <table>
                                    <tr><th>Engagement</th></tr>
                                    
                                        <tr><td><a href="/web-preview/preview-homepage-refresh/news.html">News</a></td></tr>
                                    
                                        <tr><td><a href="/web-preview/preview-homepage-refresh/events.html">Events</a></td></tr>
                                    
                                </table>
                            </div>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container-xxl">
        <div class="row py-5">
            <div class="col text-center">
                This work is supported by <a href="https://www.nsf.gov/div/index.jsp?div=OAC">NSF</a> under Grant Nos. 2030508, 1836650, and 1148698. Any opinions, findings, and conclusions or recommendations expressed in this material are those of the author(s) and do not necessarily reflect the views of the National Science Foundation.. <br />
            </div>
        </div>
    </div>
</footer>


</body>
</html>
